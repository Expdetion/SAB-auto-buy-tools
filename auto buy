-- Player reference
local player = game.Players.LocalPlayer

-- ScreenGui
local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
gui.Name = "BuyScriptUI"
gui.ResetOnSpawn = false

-- === BUY PANEL ===
local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0, 240, 0, 140)
frame.Position = UDim2.new(0.4, 0, 0.4, 0)
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
frame.BorderSizePixel = 0
frame.Active = true
frame.Draggable = true
frame.Visible = false -- Start hidden
frame.Name = "BuyPanel"

-- BUY Button
local buyButton = Instance.new("TextButton", frame)
buyButton.Size = UDim2.new(0.9, 0, 0.5, 0)
buyButton.Position = UDim2.new(0.05, 0, 0.35, 0)
buyButton.Text = "BUY"
buyButton.Font = Enum.Font.SourceSansBold
buyButton.TextScaled = true
buyButton.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
buyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
buyButton.BorderSizePixel = 0

-- === TOGGLE BUTTON (Draggable square) ===
local toggleButton = Instance.new("TextButton", gui)
toggleButton.Size = UDim2.new(0, 40, 0, 40)
toggleButton.Position = UDim2.new(0, 10, 0, 10)
toggleButton.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
toggleButton.BorderSizePixel = 0
toggleButton.Text = ""
toggleButton.Name = "ToggleButton"
toggleButton.Active = true

-- Draggable toggle button logic
local dragging = false
local dragInput, dragStart, startPos

toggleButton.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton1 then
		dragging = true
		dragStart = input.Position
		startPos = toggleButton.Position

		input.Changed:Connect(function()
			if input.UserInputState == Enum.UserInputState.End then
				dragging = false
			end
		end)
	end
end)

toggleButton.InputChanged:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseMovement then
		dragInput = input
	end
end)

game:GetService("UserInputService").InputChanged:Connect(function(input)
	if input == dragInput and dragging then
		local delta = input.Position - dragStart
		toggleButton.Position = UDim2.new(
			startPos.X.Scale, startPos.X.Offset + delta.X,
			startPos.Y.Scale, startPos.Y.Offset + delta.Y
		)
	end
end)

-- Toggle buy panel visibility
toggleButton.MouseButton1Click:Connect(function()
	frame.Visible = not frame.Visible
end)

-- BUY Logic
buyButton.MouseButton1Click:Connect(function()
	local shop = game:GetService("ReplicatedStorage"):WaitForChild("Packages"):WaitForChild("Net"):WaitForChild("RF/CoinsShopService/RequestBuy")

	coroutine.wrap(function()
		local args = {"Invisibility Cloak"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
		wait(1)

		args = {"Body Swap Potion"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
		wait(1)

		args = {"All Seeing Sentry"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
		wait(1)

		args = {"Web Slinger"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
		wait(1)

		args = {"Quantum Cloner"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
		wait(1)

		args = {"Medusa's Head"}
		pcall(function() shop:InvokeServer(unpack(args)) end)
	end)()
end)
